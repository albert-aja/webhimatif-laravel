!(function (e) {
  e.extend({
    uploadPreview: function (l) {
      var i = e.extend(
        {
          input_field: ".image-input",
          preview_box: ".image-preview",
          label_field: ".image-label",
          label_default: "Choose File",
          label_selected: "Change File",
          no_label: !1,
          success_callback: null,
        },
        l
      );

      function gcd(a, b) {
        return b == 0 ? a : gcd(b, a % b);
      }

      return window.File && window.FileList && window.FileReader
        ? void (
            void 0 !== e(i.input_field) &&
            null !== e(i.input_field) &&
            e(i.input_field).change(function () {
              var l = this.files;
              if (l.length > 0) {
                var a = l[0],
                  o = new FileReader(),
                  image = new Image();
                o.addEventListener("load", function (l) {
                  var o = l.target;

                  image.src = o.result;
                  image.onload = function () {
                    var r = gcd(image.width, image.height);
                    var maxWidth =
                      document.querySelector("#img-div").clientWidth -
                      2 * (24 * 0.5);
                    var maxHeight =
                      (maxWidth / (image.width / r)) * (image.height / r);
                    a.type.match("image")
                      ? (e(i.preview_box).css(
                          "background-image",
                          "url(" + o.result + ")"
                        ),
                        e(i.preview_box).css("background-size", "cover"),
                        e(i.preview_box).css("height", maxHeight),
                        e(i.preview_box).css("width", maxWidth),
                        e(i.preview_box).css(
                          "background-position",
                          "center center"
                        ),
                        e(i.preview_box + " label").css("opacity", 0.9))
                      : a.type.match("audio")
                      ? e(i.preview_box).html(
                          "<audio controls><source src='" +
                            o.result +
                            "' type='" +
                            a.type +
                            "' />Your browser does not support the audio element.</audio>"
                        )
                      : alert("This file type is not supported yet.");
                  };
                }),
                  0 == i.no_label && e(i.label_field).html(i.label_selected),
                  o.readAsDataURL(a),
                  i.success_callback && i.success_callback();
              } else 0 == i.no_label && e(i.label_field).html(i.label_default), e(i.preview_box).css("background-image", "none"), e(i.preview_box + " audio").remove();
            })
          )
        : (alert(
            "You need a browser with file reader support, to use this form properly."
          ),
          !1);
    },
  });
})(jQuery);
